<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de QR de Asistencia</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Generación del Código QR Diario</h1>
    <!-- Reloj en tiempo real -->
    <div id="clock" class="clock"></div>
    <!-- Contenedor del QR -->
    <div id="qr-container" class="qr-container"></div>
    <p>Escanea este código con el dispositivo del docente para registrar asistencia.</p>
  </div>
  
  <!-- Librería para generar QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script>
    // Función para actualizar el reloj cada segundo
    function actualizarReloj() {
      const clockElement = document.getElementById('clock');
      const ahora = new Date();
      // Formato: HH:MM:SS
      const hora = ahora.toLocaleTimeString();
      clockElement.textContent = `Hora actual: ${hora}`;
    }

    // Llamada inmediata para mostrar la hora al cargar
    actualizarReloj();
    // Actualiza cada segundo
    setInterval(actualizarReloj, 1000);

    // Función para generar un código único basado en la fecha, hora y un identificador aleatorio
    function generarCodigoUnico() {
      const ahora = new Date();
      // Formateamos la fecha y hora en formato YYYY-MM-DD_HH-MM-SS
      const fecha = ahora.toISOString().split('T')[0];
      const hora = ahora.toTimeString().split(' ')[0].replace(/:/g, "-");
      const random = Math.random().toString(36).substr(2, 5).toUpperCase();
      return `${fecha}_${hora}-${random}`;
    }

    // Genera la URL con el código único
    function generarEnlaceQR() {
      const codigo = generarCodigoUnico();
      // Ajusta la ruta de registro según tu entorno
      const urlRegistro = "https://faremgit.github.io/asistenciaCUR/registro.html?codigo=" + codigo;
      return { codigo, urlRegistro };
    }

    // Función para generar el código QR usando QRCode.js
    function generarQR(url) {
      const qrContainer = document.getElementById('qr-container');
      qrContainer.innerHTML = ""; // Limpiar contenedor
      new QRCode(qrContainer, {
        text: url,
        width: 256,
        height: 256,
        colorDark : "#000000",
        colorLight : "#ffffff",
        correctLevel : QRCode.CorrectLevel.H
      });
    }

    // Inicialización
    document.addEventListener("DOMContentLoaded", () => {
      const { codigo, urlRegistro } = generarEnlaceQR();
      console.log("Código generado:", codigo);
      generarQR(urlRegistro);
    });
  </script>
</body>
</html>
